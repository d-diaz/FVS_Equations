********************************************************************************
** Identify Stand
********************************************************************************
STDIDENT
{{ID}}

********************************************************************************
** Modeling Period
********************************************************************************
TIMEINT            0         5
NUMCYCLE           1

********************************************************************************
** Basic Runtime Settings
********************************************************************************
NOCALIB
NOTRIPLE
NOHTDREG
* Turn off Dwarf Mistletoe Extension, automatic if tree records have mistletoe
MISTOE
MISTOFF
END

********************************************************************************
** Input Database Keywords for reading from FIA Database
********************************************************************************
DATABASE
DSNIN
{{FVSIn}}

STANDSQL
SELECT subplot.cn AS stand_id, plot.measyear AS inv_year, 'PN' AS variant,
plot.lat AS latitude, plot.lon AS longitude, 612 AS location,
subplot.aspect AS aspect, subplot.slope AS slope, plot.elev AS elevft,
-1 AS basal_area_factor, 1 AS inv_plot_size, 999 AS brk_dbh, 1 AS num_plots,
0 AS dg_trans, 10 AS dg_measure, 0 AS htg_trans, 10 AS htg_measure, 10 AS 
mort_measure, plot.statecd AS state, plot.countycd AS county
FROM subplot, plot
WHERE subplot.cn = '%StandID%' AND subplot.plt_cn = plot.cn
ENDSQL

TREESQL
SELECT subplot.subp AS plot_id, tree AS tree_id, CASE WHEN tree.statuscd = 1
THEN tpa_unadj WHEN tree.statuscd = 2 THEN tpamort_unadj WHEN 
tree.statuscd = 3 THEN tparemv_unadj END AS tree_count, 
CASE WHEN tree.statuscd = 1 THEN 1 WHEN (tree.statuscd = 2 AND 
((plot.measyear - tree.mortyr) >10)) THEN 8 WHEN (tree.statuscd > 1 AND 
((plot.measyear - tree.mortyr) <=10)) THEN 6 END AS history, spcd AS species, 
CASE WHEN tree.statuscd = 1 THEN dia WHEN tree.statuscd > 1 THEN diacalc END 
AS dbh, tree_pnw.inc10yr_pnwrs/20 AS dg, actualht AS ht, 
tree_pnw.inc5yrht_pnwrs AS htg, CASE WHEN actualht < ht THEN actualht 
ELSE NULL END AS httopk, cr AS crratio, CASE WHEN actualht < ht THEN 96 
ELSE NULL END AS damage1, totage AS age 
FROM tree, tree_pnw, subplot, plot
WHERE plot.cn = subplot.plt_cn AND tree.cn = tree_pnw.tre_cn AND 
tree.plt_cn = subplot.plt_cn AND (tree.statuscd = 1 OR (tree.statuscd > 1 
AND ((plot.measyear - tree.mortyr) <= 10))) AND subplot.subp = tree.subp AND 
subplot.cn = '%StandID%'
ENDSQL
END


********************************************************************************
** Output Database Keywords
********************************************************************************
DATABASE
DSNOUT
{{FVSOut}}
SUMMARY
TREELIST           2         1
END

********************************************************************************
** FVS Outputs
********************************************************************************
* request list of live and dead trees
TREELIST           0                                       1

* Delete Stand Composition Table from Main Output File
DELOTAB            1
* Delete Selected Sample Tree Table from Main Output File
DELOTAB            2
* Supress ESTAB reports from Main Output File
ESTAB
OUTPUT             0
END
* END of ESTAB extension keywords


PROCESS
STOP